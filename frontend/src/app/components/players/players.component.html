<div class="players-container">
  <div class="header">
    <h1>NFL Fantasy Players</h1>
    <p class="subtitle">Manage and view all players</p>
    <button class="back-btn" (click)="goBack()">‚Üê Back to Home</button>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filter-row">
      <!-- Search -->
      <div class="filter-item">
        <label>Search by name</label>
        <input 
          type="text" 
          class="search-input"
          [(ngModel)]="searchTerm" 
          (input)="applyFilters()"
          placeholder="Search by name...">
      </div>

      <!-- Position Filter -->
      <div class="filter-item">
        <label>Position</label>
        <select 
          class="select-input"
          [(ngModel)]="selectedPosition" 
          (change)="applyFilters()">
          <option *ngFor="let pos of positions" [value]="pos">{{ pos }}</option>
        </select>
      </div>

      <!-- Team Filter -->
      <div class="filter-item">
        <label>Team</label>
        <select 
          class="select-input"
          [(ngModel)]="selectedTeam" 
          (change)="applyFilters()">
          <option *ngFor="let team of teams" [value]="team">{{ team }}</option>
        </select>
      </div>

      <!-- Price Filter -->
      <div class="filter-item">
        <label>Price</label>
        <select 
          class="select-input"
          [(ngModel)]="priceFilter" 
          (change)="applyFilters()">
          <option *ngFor="let price of priceOptions" [value]="price">{{ price }}</option>
        </select>
      </div>

      <!-- Reset Button -->
      <div class="filter-item">
        <button class="reset-btn" (click)="resetFilters()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M3 6h18M7 12h10M11 18h2"/>
          </svg>
          Reset
        </button>
      </div>
    </div>

    <!-- Player Count -->
    <div class="player-count">
      <span>{{ filteredPlayers.length }} players shown</span>
    </div>
    
    <!-- Add Player Button -->
    <div class="add-player-section">
      <button class="add-player-btn" (click)="openAddPlayerModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        Add Player
      </button>
    </div>
  </div>
  
  <!-- Add Player Modal -->
  <div class="modal-backdrop" *ngIf="showAddPlayerModal" (click)="closeAddPlayerModal()"></div>
  <div class="add-player-modal" *ngIf="showAddPlayerModal">
    <h3>Add New Player</h3>
    <form (ngSubmit)="addPlayer()" class="add-player-form">
      <div class="form-group">
        <label>First Name</label>
        <input type="text" [(ngModel)]="newPlayer.firstName" name="firstName" required>
      </div>
      
      <div class="form-group">
        <label>Last Name</label>
        <input type="text" [(ngModel)]="newPlayer.lastName" name="lastName" required>
      </div>
      
      <div class="form-group">
        <label>Team</label>
        <div class="picker-display" (click)="openTeamPicker()">
          <ng-container *ngIf="selectedTeamLogo; else noTeam">
            <img [src]="selectedTeamLogo" alt="Selected team" />
          </ng-container>
          <ng-template #noTeam>
            <span>Select Team</span>
          </ng-template>
        </div>
      </div>
      
      <div class="form-group">
        <label>Position</label>
        <select [(ngModel)]="newPlayer.position" name="position" required>
          <option value="QB">QB</option>
          <option value="RB">RB</option>
          <option value="WR">WR</option>
          <option value="TE">TE</option>
          <option value="K">K</option>
          <option value="DEF">DEF</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Jersey Number (Optional)</label>
        <input type="number" [(ngModel)]="newPlayer.jerseyNumber" name="jerseyNumber" min="0" max="99">
      </div>
      
      <div class="form-group">
        <label>Price</label>
        <input type="number" [(ngModel)]="newPlayer.price" name="price" step="0.5" required>
      </div>
      
      <div class="modal-buttons">
        <button type="button" class="btn-cancel" (click)="closeAddPlayerModal()">Cancel</button>
        <button type="submit" class="btn-submit">Add Player</button>
      </div>
    </form>
  </div>
  
  <!-- Team Picker Modal - OUTSIDE Add Player Modal -->
  <div class="modal-backdrop" *ngIf="showTeamPicker" (click)="closeTeamPicker()"></div>
  <div class="team-modal" *ngIf="showTeamPicker">
    <h3>Select Team</h3>
    <div class="teams-grid">
      <div
        *ngFor="let team of availableTeams"
        class="team-card"
        (click)="selectTeam(team)"
      >
        <img [src]="team.logo" [alt]="team.name" />
      </div>
    </div>
    <button class="close-btn" (click)="closeTeamPicker()">Close</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading players...</p>
  </div>

  <!-- Players List Container with Scroll -->
  <div *ngIf="!isLoading" class="players-list-container">
    <div class="players-list">
      <div *ngIf="filteredPlayers.length === 0" class="no-results">
        <p>No players found matching your filters.</p>
      </div>

      <div *ngFor="let player of filteredPlayers" class="player-card" [ngStyle]="{'background-color': getTeamColor(player.team)}" (click)="navigateToPlayer(player.id)" style="cursor: pointer;">
        <img class="team-logo" [src]="getTeamLogo(player.team)" [alt]="player.team">
        <div class="player-info">
          <div class="player-name-section">
            <h3>{{ player.firstName }} {{ player.lastName }}</h3>
            <p class="player-details">
              {{ player.team }} - {{ player.position }}
              <img *ngIf="isCurrentlyInjured(player.id)" src="/assets/injury.png" alt="Injured" class="injury-icon-small">
            </p>
          </div>
        </div>
        
        <div class="player-stats">
          <div class="stat">
            <span class="stat-label">Price</span>
            <span class="stat-value">${{ player.price }}M</span>
          </div>
          <div class="stat" *ngIf="player.jerseyNumber">
            <span class="stat-label">#</span>
            <span class="stat-value">{{ player.jerseyNumber }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
