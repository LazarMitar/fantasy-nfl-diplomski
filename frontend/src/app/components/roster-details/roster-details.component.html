<div class="roster-details-container">
  <div class="header">
    <h1>{{ roster?.name || 'Roster' }}</h1>
    <p class="subtitle">{{ roster?.league?.name }}</p>
    <div class="header-buttons">
      <button class="league-table-btn" (click)="goToLeagueTable()">üìä League Table</button>
      <button class="trade-btn" (click)="goToCreateTrade()">üîÑ Create trade</button>
      <button class="back-btn" (click)="goBack()">‚Üê Back</button>
    </div>
  </div>

  <div class="content-wrapper">
    <!-- Left Panel: Players List -->
    <div class="left-panel">
      <div class="filters-section">
        <div class="filter-row">
          <div class="filter-item">
            <label>Search by player name</label>
            <input type="text" class="search-input"
                   [(ngModel)]="searchTerm"
                   (input)="applyFilters()"
                   placeholder="Search player...">
          </div>

          <div class="filter-item">
            <label>Position</label>
            <select class="select-input" [(ngModel)]="selectedPosition" (change)="applyFilters()">
              <option *ngFor="let pos of positions" [value]="pos">{{ pos }}</option>
            </select>
          </div>

          <div class="filter-item">
            <label>Team</label>
            <select class="select-input" [(ngModel)]="selectedTeam" (change)="applyFilters()">
              <option *ngFor="let team of teams" [value]="team">{{ team }}</option>
            </select>
          </div>

          <div class="filter-item">
            <label>Price</label>
            <select class="select-input" [(ngModel)]="priceFilter" (change)="applyFilters()">
              <option *ngFor="let price of priceOptions" [value]="price">{{ price }}</option>
            </select>
          </div>

          <div class="filter-item">
            <button class="reset-btn" (click)="resetFilters()">
              Reset
            </button>
          </div>
        </div>

        <div class="player-count">
          <span>{{ filteredPlayers.length }} players available</span>
        </div>
      </div>

      <!-- Players List -->
      <div class="players-list-container">
        <div *ngIf="isLoading" class="loading">
          <p>Loading available players...</p>
        </div>

        <div *ngIf="!isLoading" class="players-list">
          <div *ngFor="let player of filteredPlayers" 
               class="player-card" 
               [ngStyle]="{'background-color': getTeamColor(player.team)}"
               (click)="goToPlayerDetails(player.id)">
            <img class="team-logo" [src]="getTeamLogo(player.team)" [alt]="player.team">
            <div class="player-info">
              <h3>{{ player.firstName }} {{ player.lastName }}</h3>
              <p class="player-details">{{ player.team }} - {{ player.position }}</p>
            </div>
            
            <div class="player-stats">
              <div class="stat">
                <span class="stat-label">Price</span>
                <span class="stat-value">${{ player.price }}M</span>
              </div>
            </div>

            <div class="player-action">
              <button *ngIf="!isPlayerInRoster(player.id)" 
                      class="add-btn" 
                      (click)="addPlayerToRoster(player.id); $event.stopPropagation()">
                +
              </button>
              <button *ngIf="isPlayerInRoster(player.id)" 
                      class="remove-btn" 
                      (click)="removePlayerFromRoster(player.id); $event.stopPropagation()">
                ‚úï
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Trades Section -->
      <div class="pending-trades-section">
        <h2>Pending trades</h2>
        <div *ngIf="pendingTrades.length === 0" class="no-trades">
          <p>No pending trades</p>
        </div>
        <div *ngIf="pendingTrades.length > 0" class="trades-list">
          <div *ngFor="let trade of pendingTrades" class="trade-card">
            <div class="trade-players-info">
              <div class="trade-player" 
                   [ngStyle]="{'background-color': getTeamColor(trade.initiatorRosterPlayer.player.team)}">
                <img class="trade-team-logo" [src]="getTeamLogo(trade.initiatorRosterPlayer.player.team)" 
                     [alt]="trade.initiatorRosterPlayer.player.team">
                <div class="trade-player-details">
                  <h4>{{ trade.initiatorRosterPlayer.player.firstName }} {{ trade.initiatorRosterPlayer.player.lastName }}</h4>
                  <p>{{ trade.initiatorRosterPlayer.player.team }} - {{ trade.initiatorRosterPlayer.player.position }}</p>
                  <p class="trade-player-price">${{ trade.initiatorRosterPlayer.player.price }}M</p>
                  <p *ngIf="isInitiator(trade)" class="trade-role">My player</p>
                </div>
              </div>
              
              <div class="trade-arrow">‚Üî</div>
              
              <div class="trade-player" 
                   [ngStyle]="{'background-color': getTeamColor(trade.receiverRosterPlayer.player.team)}">
                <img class="trade-team-logo" [src]="getTeamLogo(trade.receiverRosterPlayer.player.team)" 
                     [alt]="trade.receiverRosterPlayer.player.team">
                <div class="trade-player-details">
                  <h4>{{ trade.receiverRosterPlayer.player.firstName }} {{ trade.receiverRosterPlayer.player.lastName }}</h4>
                  <p>{{ trade.receiverRosterPlayer.player.team }} - {{ trade.receiverRosterPlayer.player.position }}</p>
                  <p class="trade-player-price">${{ trade.receiverRosterPlayer.player.price }}M</p>
                  <p *ngIf="isReceiver(trade)" class="trade-role">My player</p>
                </div>
              </div>
            </div>
            
            <div class="trade-actions">
              <button *ngIf="isInitiator(trade)" 
                      class="trade-action-btn cancel-btn" 
                      (click)="cancelTrade(trade.id!)">
                Cancel
              </button>
              <button *ngIf="isReceiver(trade)" 
                      class="trade-action-btn accept-btn" 
                      (click)="acceptTrade(trade.id!)">
                Accept
              </button>
              <button *ngIf="isReceiver(trade)" 
                      class="trade-action-btn reject-btn" 
                      (click)="rejectTrade(trade.id!)">
                Reject
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Panel: Roster Display -->
    <div class="right-panel">
      <div class="roster-stats">
        <div class="stat-item">
          <span class="stat-label">Budget</span>
          <span class="stat-value">${{ roster?.budget?.toFixed(2) }}M</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Players</span>
          <span class="stat-value">{{ rosterPlayers.length }}/13</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Wins</span>
          <span class="stat-value">{{ roster?.wins || 0 }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Losses</span>
          <span class="stat-value">{{ roster?.losses || 0 }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total points</span>
          <span class="stat-value">{{ (roster?.points || 0) | number:'1.1-1' }}</span>
        </div>
      </div>

      <!-- Field Visualization -->
      <div class="field-container">
        <div class="field">
          <!-- Starting 8 Players -->
          <div class="field-row starters-row">
            <div *ngFor="let starter of getStarterPlayers()" 
                 class="player-card-field"
                 [class.selected]="selectedStarterId === starter.player.id"
                 [ngStyle]="{'background-color': getTeamColor(starter.player.team)}"
                 (click)="goToPlayerDetails(starter.player.id)">
              <button class="remove-field-btn" (click)="removePlayerFromRoster(starter.player.id); $event.stopPropagation()">‚úï</button>
              <button class="swap-btn" (click)="toggleStarterSelection(starter.player.id); $event.stopPropagation()" title="Swap with bench">‚áÑ</button>
              <span class="player-price">${{ starter.player.price }}M</span>
              <img class="field-team-logo" [src]="getTeamLogo(starter.player.team)" [alt]="starter.player.team">
              <span class="player-name">{{ starter.player.firstName }} {{ starter.player.lastName }}</span>
              <span class="player-position">{{ starter.player.position }}</span>
            </div>
          </div>

          <!-- Empty slots for starters -->
          <div class="field-row starters-row">
            <ng-container *ngFor="let starterSlot of getEmptyStarterSlots()">
              <div class="empty-slot" [attr.data-position]="starterSlot.position">
                <span class="position-label">{{ starterSlot.position }}</span>
                <span class="plus-sign">+</span>
              </div>
            </ng-container>
          </div>

          <!-- Bench 5 Players -->
          <div class="bench-section">
            <h3>Bench ({{ getBenchPlayers().length }}/5)</h3>
            <div class="bench-row">
              <div *ngFor="let bench of getBenchPlayers()" 
                   class="player-card-field bench-card"
                   [class.selected]="selectedBenchId === bench.player.id"
                   [ngStyle]="{'background-color': getTeamColor(bench.player.team)}"
                   (click)="goToPlayerDetails(bench.player.id)">
                <button class="remove-field-btn" (click)="removePlayerFromRoster(bench.player.id); $event.stopPropagation()">‚úï</button>
                <button class="swap-btn" (click)="toggleBenchSelection(bench.player.id); $event.stopPropagation()" title="Swap with starters">‚áÑ</button>
                <span class="player-price">${{ bench.player.price }}M</span>
                <img class="field-team-logo" [src]="getTeamLogo(bench.player.team)" [alt]="bench.player.team">
                <span class="player-name">{{ bench.player.firstName }} {{ bench.player.lastName }}</span>
                <span class="player-position">{{ bench.player.position }}</span>
              </div>
            </div>

            <!-- Empty slots for bench -->
            <div class="bench-row">
              <div *ngFor="let i of [].constructor(5 - getBenchPlayers().length)" 
                   class="empty-slot">
                <span>+</span>
              </div>
            </div>
          </div>

          <!-- Captain Selection -->
          <div class="captain-section">
            <h3>Captain</h3>
            <div class="captain-display">
              <div *ngIf="getCaptain(); else noCaptain" class="captain-card" 
                   [ngStyle]="{'background-color': getTeamColor(getCaptain()!.player.team)}"
                   (click)="goToPlayerDetails(getCaptain()!.player.id)">
                <span class="captain-badge">C</span>
                <img class="captain-team-logo" [src]="getTeamLogo(getCaptain()!.player.team)" [alt]="getCaptain()!.player.team">
                <span class="captain-name">{{ getCaptain()!.player.firstName }} {{ getCaptain()!.player.lastName }}</span>
                <span class="captain-position">{{ getCaptain()!.player.position }}</span>
                <button class="remove-captain-btn" (click)="removeCaptain(); $event.stopPropagation()">‚úï</button>
              </div>
              <ng-template #noCaptain>
                <div class="no-captain">
                  <span>Please, choose your captain</span>
                </div>
              </ng-template>
            </div>
            
            <div *ngIf="!getCaptain()" class="captain-options">
              <p class="captain-label">Choose captain from your starters:</p>
              <div class="starter-buttons">
                <button *ngFor="let starter of getStarterPlayers()" 
                        class="starter-select-btn"
                        [ngStyle]="{'background-color': getTeamColor(starter.player.team)}"
                        (click)="setCaptain(starter.player.id)">
                  {{ starter.player.firstName }} {{ starter.player.lastName }} ({{ starter.player.position }})
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- My Matches Section - Outside field-container -->
      <div class="matches-section" *ngIf="duels.length > 0 && currentDuel">
        <h3>My Matches</h3>
        <div class="match-card" (click)="goToMatchDetails()">
          <div class="match-navigation">
            <button class="nav-btn" (click)="previousDuel(); $event.stopPropagation()" [disabled]="currentDuelIndex === 0">
              ‚óÄ
            </button>
            <span class="week-info">Week {{ currentDuel.gameweek.weekNumber }} of {{ duels.length }}</span>
            <button class="nav-btn" (click)="nextDuel(); $event.stopPropagation()" [disabled]="currentDuelIndex === duels.length - 1">
              ‚ñ∂
            </button>
          </div>

          <div class="match-content">
            <div class="team my-team">
              <span class="team-name">{{ roster?.name }}</span>
              <span class="team-indicator">{{ isHomeTeam() ? 'üè†' : 'üèà' }}</span>
              <span class="team-score" *ngIf="currentDuel.status !== DuelStatus.PENDING">
                {{ getMyScore().toFixed(1) }}
              </span>
            </div>

            <div class="match-vs">
              <span *ngIf="currentDuel.status === DuelStatus.PENDING">VS</span>
              <span *ngIf="currentDuel.status === DuelStatus.IN_PROGRESS" class="live-badge">üî¥ LIVE</span>
              <span *ngIf="currentDuel.status === DuelStatus.COMPLETED">-</span>
            </div>

            <div class="team opponent-team">
              <span class="team-name">{{ getOpponentName() }}</span>
              <span class="team-indicator">{{ isHomeTeam() ? 'üèà' : 'üè†' }}</span>
              <span class="team-score" *ngIf="currentDuel.status !== DuelStatus.PENDING">
                {{ getOpponentScore().toFixed(1) }}
              </span>
            </div>
          </div>

          <div class="match-status">
            <span *ngIf="currentDuel.status === DuelStatus.PENDING" class="status-pending">
              üìÖ Upcoming
            </span>
            <span *ngIf="currentDuel.status === DuelStatus.IN_PROGRESS" class="status-live">
              üî¥ In Progress
            </span>
            <span *ngIf="currentDuel.status === DuelStatus.COMPLETED && getDuelResult() === 'WON'" class="status-won">
              ‚úÖ YOU WON!
            </span>
            <span *ngIf="currentDuel.status === DuelStatus.COMPLETED && getDuelResult() === 'LOST'" class="status-lost">
              ‚ùå YOU LOST
            </span>
            <span *ngIf="currentDuel.status === DuelStatus.COMPLETED && getDuelResult() === 'DRAW'" class="status-draw">
              ü§ù DRAW
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

